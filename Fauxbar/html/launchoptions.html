<html>
<!--
	Because Fauxbar's proper Options page is just Fauxbar's normal page with a hash value added on, this page "launches" the proper Options page.
	Without this launch page, Chrome would sometimes switch to the Options page tab even if the Options had been closed by the user, which wasn't ideal.
	So, by opening the launch page, then launching a new Options tab, and then closing the launch page, Chrome *has* to open the launch page every time.
	This means the Options page definitely gets shown every time. The quick open/close behaviour isn't ideal but at least it's consistent.
-->
<head>
<title>Loading...</title>
<script type="text/javascript" src="/js/jquery-1.6.3.min.js"></script>
<script type="text/javascript" src="/js/common.js"></script>
<script type="text/javascript" src="/js/common-1.js"></script>
<script type="text/javascript" src="/js/logerror.js"></script>
<script type="text/javascript">

	// http://phpjs.org/functions/strstr:551
	function strstr (haystack, needle, bool) {
		var pos = 0;
		haystack += '';
		pos = haystack.indexOf(needle);
		if (pos == -1) {
			return false;
		} else {
			if (bool) {
				return haystack.substr(0, pos);
			} else {
				return haystack.slice(pos);
			}
		}
	}
	// If Options page already exists somewhere, switch to it.
	// Otherwise, it doesn't exist, create a new tab.
	// Then, close this launch page since it's no longer needed.
	setTimeout(function(){
		chrome.tabs.getAllInWindow(null, function(tabs){
			var found = false;
			var fb = chrome.extension.getURL("/html/fauxbar.html");
			for (var t in tabs) {
				if ((tabs[t].title == "Fauxbar: Options" || tabs[t].title == "Fauxbar Lite: Options") && strstr(tabs[t].url, fb+'#')) {
					found = true;
					chrome.tabs.update(tabs[t].id, {selected:true});
					chrome.tabs.getCurrent(function(tab){
						chrome.tabs.remove(tab.id);
					});
				}
			}
			if (!found) {
				for (var tt in tabs) {
					if (tabs[tt].title == "Fauxbar" && (strstr(tabs[tt].url, fb) || strstr(tabs[tt].url, "chrome://newtab"))) {
						found = true;
						chrome.tabs.update(tabs[tt].id, {selected:true, url:chrome.extension.getURL("/html/fauxbar.html#options=1")}, function(tab){
							chrome.extension.sendRequest({action:"openOptions", tabId:tab.id});
						});
						chrome.tabs.getCurrent(function(tab){
							chrome.tabs.remove(tab.id);
						});
					}
				}
				if (!found) {
					chrome.tabs.create({url:chrome.extension.getURL("/html/fauxbar.html#options=1"), selected:true});
					chrome.tabs.getCurrent(function(tab){
						chrome.tabs.remove(tab.id);
					});
				}
			}
		});
	}, 1);
</script>
</head>
<body></body>
</html>